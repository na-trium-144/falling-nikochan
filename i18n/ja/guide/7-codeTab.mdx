import { BeatSlime } from "@/edit/timingTab.js";
import { CautionIcon } from "@/common/mdxIcons";

- コードタブでは譜面データをテキスト (Lua 言語のプログラム) として編集することができます。
  - タイミングタブや音符タブで編集した内容は自動的にコードタブにも反映され、逆にコードタブの編集も自動的に他のタブに反映されます。
- コードタブを一切使わなくても譜面は作れますが、複数の音符をまとめて選択してコピペすることができたり、またLua言語が書ければ変数やループ、functionなどを使うこともできるので、使いこなせると便利かもしれません。
- 基本的なルールとしては、 テキストは上から順に読み、`Note()`が音符1つを表し、`Step()`が休符(音符と音符の間の空き時間)を表します。
  - 音符タブでは音符の追加と削除しかできず、すでに置かれている音符のタイミングをすべてずらすといったことはできませんが、
  コードタブでは`Step()`を挿入したり削除するとそれ以降の音符のタイミングがすべてずれます。
- コードタブを編集すると、自動的に編集したコードが実行されます。
  - エラーが発生した場合(文法が間違っている場合など)は下部に赤色でメッセージが表示されます。
  - エラーが表示されている状態でコードタブ以外のタブへ移動すると、コードタブの変更は保存されず、最後にエラーなく実行できた時点の内容に戻されてしまうので注意してください。
- コードタブで`Note()`などの各種コマンドにカーソルを合わせると、タイムバーもその音符に対応する時刻に移動します。
- 行番号の横の <CautionIcon /> はタイムバーのカーソル位置に対応する行、
<span className="text-sm align-middle">i</span> はそれぞれの小節線に対応する行を表しています。
- Ctrl+F (⌘+F) で検索・置き換えができます。
置き換えは Ctrl+R ではないので注意してください。(ページをリロードしてしまいます)
- Falling Nikochan 特有のコマンドは以下の通りです。
  - `Note(x, vx, vy, big, fall)`: 音符を置きます。
    - x, vx, vy は数値、big, fall は`true`または`false`を指定してください。
  - `Step(a, b)`: b 分音符 a 個分の休符を表します。 
    - a は0以上の整数、 b は1以上の整数にしてください。
  - `BPM(bpmの値)`: BPMを変更します。正の数値にしてください。
  - `Accel(速度の値)`: 速度を変更します。0や負の値も使えます。
  - `AccelBegin(速度の値)` 〜 `AccelEnd(速度の値)`: なめらかな速度変化をします。
    - (仕様上 `Accel` と `AccelBegin` は同一です。 `AccelEnd` の前の最後の `Accel` または `AccelBegin` から変化を開始します。)
  - `Beat(拍子)` または `Beat(拍子, a, b)`: 拍子を変更します。
    - 例えば 4/4 拍子なら `{{4, 4, 4, 4}}`、
    7/8 拍子なら `{{4, 4, 4, 8}}`、
    4/4 + 3/4 拍子なら `{{4, 4, 4, 4}, {4, 4, 4}}`
    のように指定します。
      - (<BeatSlime size={4} /> とは逆に左から右にカウントします)
    - 拍子カウントのオフセット ( a / b ) を拍子の後ろに指定できます。
    aは0以上の整数、bは1以上の整数です。
- `--` (半角のマイナス2つ)で始まる行はコメントです(何を書いても無視されます)。
- その他のLua言語の文法に関してはここでは説明しないので各自で調べてください。
